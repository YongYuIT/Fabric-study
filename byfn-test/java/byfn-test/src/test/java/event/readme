based on query_based_couch
improve PeerUser